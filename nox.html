<html>
<head>
  <title></title>
  <meta http-equiv="X-UA-Compatible" content="IE=8" />
  <script type="text/javascript" src="vendor/underscore.js"></script>
  <script type="text/javascript" src="vendor/jquery-1.9.1.min.js"></script>
  <script type="text/javascript" src="nox.js"></script>
  <script type="text/javascript" src="bindings.js"></script>
  <style type="text/css">
    .highlight-true {
      background: green;
    }
  </style>
  <script type="text/javascript">
    var app = {
      username: "joe",
      people: [],
      numDone: function(){
        return _.select(this.people, function(e){ return e.done == true; }).length;
      },
      removePerson: function(person){
        this.people = _.without(this.people, person);
      }
    };

    app.clearPeople = function(){
      this.people = [];      
    };

    app.fillPeople = function(){
      this.people = [
        {id: _.uniqueId(), name: "joe", done: true, tags: []},
        {id: _.uniqueId(), name: "bob", done: false, tags: []},
        {id: _.uniqueId(), name: "bill", done: true, tags: []}
      ];

      for(var i=0; i < 1000; i++){
        this.people.push({id: _.uniqueId(), name: "joe"+i, done: true, tags: []});
      }

      for(var i=0; i < 1; i++){
        var p = {id: _.uniqueId(), name: "name:"+i, done: (i % 2) == 0};

        p.tags = [
          {id: _.uniqueId(), text: "tag"+_.uniqueId()},
          {id: _.uniqueId(), text: "tag"+_.uniqueId()},
          {id: _.uniqueId(), text: "tag"+_.uniqueId()}
        ];

        this.people.push(p);
      }
    };


    var rootNode = null;

    $(function(){
      rootNode = Nox.bind(app, {}, document.body, new Nox.Node()).init().update();



      // $("#leak").on("click", function(){

      //   var i=0;

      //   var id = setInterval(function(){


      //     if((i % 2) == 0){
      //       console.info("**** " + i + " - clean");
      //       app.clearPeople();
      //     }else{
      //       console.info("**** " + i + " - fill");
      //       app.fillPeople();
      //     }

      //     rootNode.update();

      //     i++;

      //     if(i == 100){
      //       clearInterval(id);
      //     }

      //   }, 1000);

      // });
    });
  </script>
</head>
<body>


  <button id="leak">leak</button>

  <div>
    <a href="#" data-click="this.clearPeople()">clear</a>
    <a href="#" data-click="this.fillPeople()">fill</a>
  </div>

  <input data-value="this.username"/>
  <span data-text="this.username"></span>

  <ul data-loop="{entries: 'this.people', as: 'person'}">
    <li class="highlight-{{person.done}}">
      <input type="checkbox" data-check="person.done"/>
      <span data-text="person.name"></span>
      <input data-value="this.username"/>
      <input data-value="person.name"/>
      <input data-value="this.username"/>
      <input data-value="person.name"/>
      <!--span data-clock></span-->
      <a href="#" data-click="this.removePerson(person)">del</a>
      <ul data-loop="{entries: 'person.tags', as: 'tag'}">
        <li>
          <span data-text="tag.text"></span>
          <input data-value="tag.text"/>
        </li>
      </ul>
      <!--span data-clock></span-->
    </li>
  </ul>

  <span>{{this.numDone()}} done von insgesamt {{this.people.length}} personen</span>

  <div>
    <textarea data-value="JSON.stringify(this)" rows="10" cols="80" disabled></textarea>
  </div>

</body>
</html>